"use strict";function serveStatic(e,r){if(!e)throw new TypeError("root path required");if("string"!=typeof e)throw new TypeError("root path must be a string");var t=Object.create(r||null),a=t.fallthrough!==!1,n=t.redirect!==!1,s=t.setHeaders;if(s&&"function"!=typeof s)throw new TypeError("option setHeaders must be function");t.maxage=t.maxage||t.maxAge||0,t.root=resolve(e);var i=n?createRedirectDirectoryListener():createNotFoundDirectoryListener();return function(e,r,n){if("GET"!==e.method&&"HEAD"!==e.method)return a?n():(r.statusCode=405,r.setHeader("Allow","GET, HEAD"),r.setHeader("Content-Length","0"),void r.end());var o=!a,u=parseUrl.original(e),l=parseUrl(e).pathname;"/"===l&&"/"!==u.pathname.substr(-1)&&(l="");var c=send(e,l,t);c.on("directory",i),s&&c.on("headers",s),a&&c.on("file",function(){o=!0}),c.on("error",function(e){return!o&&e.statusCode<500?void n():void n(e)}),c.pipe(r)}}function collapseLeadingSlashes(e){for(var r=0;r<e.length&&"/"===e[r];r++);return r>1?"/"+e.substr(r):e}function createHtmlDocument(e,r){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>'+e+"</title>\n</head>\n<body>\n<pre>"+r+"</pre>\n</body>\n"}function createNotFoundDirectoryListener(){return function(){this.error(404)}}function createRedirectDirectoryListener(){return function(e){if(this.hasTrailingSlash())return void this.error(404);var r=parseUrl.original(this.req);r.path=null,r.pathname=collapseLeadingSlashes(r.pathname+"/");var t=encodeUrl(url.format(r)),a=createHtmlDocument("Redirecting",'Redirecting to <a href="'+escapeHtml(t)+'">'+escapeHtml(t)+"</a>");e.statusCode=301,e.setHeader("Content-Type","text/html; charset=UTF-8"),e.setHeader("Content-Length",Buffer.byteLength(a)),e.setHeader("Content-Security-Policy","default-src 'self'"),e.setHeader("X-Content-Type-Options","nosniff"),e.setHeader("Location",t),e.end(a)}}var encodeUrl=require("encodeurl"),escapeHtml=require("escape-html"),parseUrl=require("parseurl"),resolve=require("path").resolve,send=require("send"),url=require("url");module.exports=serveStatic,module.exports.mime=send.mime;