"use strict";var utils=require("./utils"),formats=require("./formats"),arrayPrefixGenerators={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},toISO=Date.prototype.toISOString,defaults={delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,serializeDate:function(e){return toISO.call(e)},skipNulls:!1,strictNullHandling:!1},stringify=function n(e,r,t,a,i,s,o,u,f,l,c,p){var d=e;if("function"==typeof o)d=o(r,d);else if(d instanceof Date)d=l(d);else if(null===d){if(a)return s&&!p?s(r):r;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||utils.isBuffer(d)){if(s){var h=p?r:s(r);return[c(h)+"="+c(s(d))]}return[c(r)+"="+c(String(d))]}var v=[];if("undefined"==typeof d)return v;var g;if(Array.isArray(o))g=o;else{var m=Object.keys(d);g=u?m.sort(u):m}for(var y=0;y<g.length;++y){var b=g[y];i&&null===d[b]||(v=Array.isArray(d)?v.concat(n(d[b],t(r,b),t,a,i,s,o,u,f,l,c,p)):v.concat(n(d[b],r+(f?"."+b:"["+b+"]"),t,a,i,s,o,u,f,l,c,p)))}return v};module.exports=function(e,r){var t=e,a=r||{};if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw new TypeError("Encoder has to be a function.");var n="undefined"==typeof a.delimiter?defaults.delimiter:a.delimiter,i="boolean"==typeof a.strictNullHandling?a.strictNullHandling:defaults.strictNullHandling,s="boolean"==typeof a.skipNulls?a.skipNulls:defaults.skipNulls,o="boolean"==typeof a.encode?a.encode:defaults.encode,u="function"==typeof a.encoder?a.encoder:defaults.encoder,f="function"==typeof a.sort?a.sort:null,l="undefined"==typeof a.allowDots?!1:a.allowDots,c="function"==typeof a.serializeDate?a.serializeDate:defaults.serializeDate,p="boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:defaults.encodeValuesOnly;if("undefined"==typeof a.format)a.format=formats["default"];else if(!Object.prototype.hasOwnProperty.call(formats.formatters,a.format))throw new TypeError("Unknown format option provided.");var h,v,d=formats.formatters[a.format];"function"==typeof a.filter?(v=a.filter,t=v("",t)):Array.isArray(a.filter)&&(v=a.filter,h=v);var g=[];if("object"!=typeof t||null===t)return"";var m;m=a.arrayFormat in arrayPrefixGenerators?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":"indices";var y=arrayPrefixGenerators[m];h||(h=Object.keys(t)),f&&h.sort(f);for(var b=0;b<h.length;++b){var w=h[b];s&&null===t[w]||(g=g.concat(stringify(t[w],w,y,i,s,o?u:null,v,f,l,c,d,p)))}return g.join(n)};