"use strict";function parseAccept(e){for(var r=splitMediaTypes(e),t=0,a=0;t<r.length;t++){var n=parseMediaType(r[t].trim(),t);n&&(r[a++]=n)}return r.length=a,r}function parseMediaType(e,r){var t=simpleMediaTypeRegExp.exec(e);if(!t)return null;var a=Object.create(null),n=1,s=t[2],i=t[1];if(t[3])for(var o=splitParameters(t[3]).map(splitKeyValuePair),u=0;u<o.length;u++){var c=o[u],p=c[0].toLowerCase(),f=c[1],l=f&&'"'===f[0]&&'"'===f[f.length-1]?f.substr(1,f.length-2):f;if("q"===p){n=parseFloat(l);break}a[p]=l}return{type:i,subtype:s,params:a,q:n,i:r}}function getMediaTypePriority(e,r,t){for(var a={o:-1,q:0,s:0},n=0;n<r.length;n++){var s=specify(e,r[n],t);s&&(a.s-s.s||a.q-s.q||a.o-s.o)<0&&(a=s)}return a}function specify(e,r,t){var a=parseMediaType(e),n=0;if(!a)return null;if(r.type.toLowerCase()==a.type.toLowerCase())n|=4;else if("*"!=r.type)return null;if(r.subtype.toLowerCase()==a.subtype.toLowerCase())n|=2;else if("*"!=r.subtype)return null;var s=Object.keys(r.params);if(s.length>0){if(!s.every(function(e){return"*"==r.params[e]||(r.params[e]||"").toLowerCase()==(a.params[e]||"").toLowerCase()}))return null;n|=1}return{i:t,o:r.i,q:r.q,s:n}}function preferredMediaTypes(e,r){var t=parseAccept(void 0===e?"*/*":e||"");if(!r)return t.filter(isQuality).sort(compareSpecs).map(getFullType);var a=r.map(function(e,r){return getMediaTypePriority(e,t,r)});return a.filter(isQuality).sort(compareSpecs).map(function(e){return r[a.indexOf(e)]})}function compareSpecs(e,r){return r.q-e.q||r.s-e.s||e.o-r.o||e.i-r.i||0}function getFullType(e){return e.type+"/"+e.subtype}function isQuality(e){return e.q>0}function quoteCount(e){for(var r=0,t=0;-1!==(t=e.indexOf('"',t));)r++,t++;return r}function splitKeyValuePair(e){var t,a,r=e.indexOf("=");return-1===r?t=e:(t=e.substr(0,r),a=e.substr(r+1)),[t,a]}function splitMediaTypes(e){for(var r=e.split(","),t=1,a=0;t<r.length;t++)quoteCount(r[a])%2==0?r[++a]=r[t]:r[a]+=","+r[t];return r.length=a+1,r}function splitParameters(e){for(var r=e.split(";"),t=1,a=0;t<r.length;t++)quoteCount(r[a])%2==0?r[++a]=r[t]:r[a]+=";"+r[t];r.length=a+1;for(var t=0;t<r.length;t++)r[t]=r[t].trim();return r}module.exports=preferredMediaTypes,module.exports.preferredMediaTypes=preferredMediaTypes;var simpleMediaTypeRegExp=/^\s*([^\s\/;]+)\/([^;\s]+)\s*(?:;(.*))?$/;