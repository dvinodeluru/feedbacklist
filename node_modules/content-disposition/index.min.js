"use strict";function contentDisposition(e,r){var t=r||{},a=t.type||"attachment",n=createparams(e,t.fallback);return format(new ContentDisposition(a,n))}function createparams(e,r){if(void 0!==e){var t={};if("string"!=typeof e)throw new TypeError("filename must be a string");if(void 0===r&&(r=!0),"string"!=typeof r&&"boolean"!=typeof r)throw new TypeError("fallback must be a string or boolean");if("string"==typeof r&&NON_LATIN1_REGEXP.test(r))throw new TypeError("fallback must be ISO-8859-1 string");var a=basename(e),n=TEXT_REGEXP.test(a),s="string"!=typeof r?r&&getlatin1(a):basename(r),i="string"==typeof s&&s!==a;return(i||!n||HEX_ESCAPE_REGEXP.test(a))&&(t["filename*"]=a),(n||i)&&(t.filename=i?s:a),t}}function format(e){var r=e.parameters,t=e.type;if(!t||"string"!=typeof t||!TOKEN_REGEXP.test(t))throw new TypeError("invalid type");var a=String(t).toLowerCase();if(r&&"object"==typeof r)for(var n,s=Object.keys(r).sort(),i=0;i<s.length;i++){n=s[i];var o="*"===n.substr(-1)?ustring(r[n]):qstring(r[n]);a+="; "+n+"="+o}return a}function decodefield(e){var r=EXT_VALUE_REGEXP.exec(e);if(!r)throw new TypeError("invalid extended field value");var n,t=r[1].toLowerCase(),a=r[2],s=a.replace(HEX_ESCAPE_REPLACE_REGEXP,pdecode);switch(t){case"iso-8859-1":n=getlatin1(s);break;case"utf-8":n=new Buffer(s,"binary").toString("utf8");break;default:throw new TypeError("unsupported charset in extended field")}return n}function getlatin1(e){return String(e).replace(NON_LATIN1_REGEXP,"?")}function parse(e){if(!e||"string"!=typeof e)throw new TypeError("argument string is required");var r=DISPOSITION_TYPE_REGEXP.exec(e);if(!r)throw new TypeError("invalid type format");var n,o,t=r[0].length,a=r[1].toLowerCase(),s=[],i={};for(t=PARAM_REGEXP.lastIndex=";"===r[0].substr(-1)?t-1:t;r=PARAM_REGEXP.exec(e);){if(r.index!==t)throw new TypeError("invalid parameter format");if(t+=r[0].length,n=r[1].toLowerCase(),o=r[2],-1!==s.indexOf(n))throw new TypeError("invalid duplicate parameter");s.push(n),n.indexOf("*")+1!==n.length?"string"!=typeof i[n]&&('"'===o[0]&&(o=o.substr(1,o.length-2).replace(QESC_REGEXP,"$1")),i[n]=o):(n=n.slice(0,-1),o=decodefield(o),i[n]=o)}if(-1!==t&&t!==e.length)throw new TypeError("invalid parameter format");return new ContentDisposition(a,i)}function pdecode(e,r){return String.fromCharCode(parseInt(r,16))}function pencode(e){var r=String(e).charCodeAt(0).toString(16).toUpperCase();return 1===r.length?"%0"+r:"%"+r}function qstring(e){var r=String(e);return'"'+r.replace(QUOTE_REGEXP,"\\$1")+'"'}function ustring(e){var r=String(e),t=encodeURIComponent(r).replace(ENCODE_URL_ATTR_CHAR_REGEXP,pencode);return"UTF-8''"+t}function ContentDisposition(e,r){this.type=e,this.parameters=r}module.exports=contentDisposition,module.exports.parse=parse;var basename=require("path").basename,ENCODE_URL_ATTR_CHAR_REGEXP=/[\x00-\x20"'()*,\/:;<=>?@[\\\]{}\x7f]/g,HEX_ESCAPE_REGEXP=/%[0-9A-Fa-f]{2}/,HEX_ESCAPE_REPLACE_REGEXP=/%([0-9A-Fa-f]{2})/g,NON_LATIN1_REGEXP=/[^\x20-\x7e\xa0-\xff]/g,QESC_REGEXP=/\\([\u0000-\u007f])/g,QUOTE_REGEXP=/([\\"])/g,PARAM_REGEXP=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g,TEXT_REGEXP=/^[\x20-\x7e\x80-\xff]+$/,TOKEN_REGEXP=/^[!#$%&'*+.0-9A-Z^_`a-z|~-]+$/,EXT_VALUE_REGEXP=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/,DISPOSITION_TYPE_REGEXP=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;