function format(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var r=e.parameters,t=e.subtype,a=e.suffix,n=e.type;if(!n||!typeNameRegExp.test(n))throw new TypeError("invalid type");if(!t||!subtypeNameRegExp.test(t))throw new TypeError("invalid subtype");var s=n+"/"+t;if(a){if(!typeNameRegExp.test(a))throw new TypeError("invalid suffix");s+="+"+a}if(r&&"object"==typeof r)for(var i,o=Object.keys(r).sort(),u=0;u<o.length;u++){if(i=o[u],!tokenRegExp.test(i))throw new TypeError("invalid parameter name");s+="; "+i+"="+qstring(r[i])}return s}function parse(e){if(!e)throw new TypeError("argument string is required");if("object"==typeof e&&(e=getcontenttype(e)),"string"!=typeof e)throw new TypeError("argument string is required to be a string");var a,n,o,r=e.indexOf(";"),t=-1!==r?e.substr(0,r):e,s=splitType(t),i={};for(paramRegExp.lastIndex=r;n=paramRegExp.exec(e);){if(n.index!==r)throw new TypeError("invalid parameter format");r+=n[0].length,a=n[1].toLowerCase(),o=n[2],'"'===o[0]&&(o=o.substr(1,o.length-2).replace(qescRegExp,"$1")),i[a]=o}if(-1!==r&&r!==e.length)throw new TypeError("invalid parameter format");return s.parameters=i,s}function getcontenttype(e){return"function"==typeof e.getHeader?e.getHeader("content-type"):"object"==typeof e.headers?e.headers&&e.headers["content-type"]:void 0}function qstring(e){var r=String(e);if(tokenRegExp.test(r))return r;if(r.length>0&&!textRegExp.test(r))throw new TypeError("invalid parameter value");return'"'+r.replace(quoteRegExp,"\\$1")+'"'}function splitType(e){var r=typeRegExp.exec(e.toLowerCase());if(!r)throw new TypeError("invalid media type");var n,t=r[1],a=r[2],s=a.lastIndexOf("+");-1!==s&&(n=a.substr(s+1),a=a.substr(0,s));var i={type:t,subtype:a,suffix:n};return i}var paramRegExp=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,textRegExp=/^[\u0020-\u007e\u0080-\u00ff]+$/,tokenRegExp=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,qescRegExp=/\\([\u0000-\u007f])/g,quoteRegExp=/([\\"])/g,subtypeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,typeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,typeRegExp=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;exports.format=format,exports.parse=parse;